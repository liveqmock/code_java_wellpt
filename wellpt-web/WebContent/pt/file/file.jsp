<%@ page language="java" contentType="text/html; charset=UTF-8"	pageEncoding="UTF-8"%><%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%><%@ include file="/pt/common/taglibs.jsp"%><!DOCTYPE html><html lang="en"><head><title>	<c:if test="${ operate ne 'add'}">		${file.title}	</c:if>	<c:choose>		<c:when test="${ operate eq 'add'}">			<c:choose>				<c:when test="${not empty fileShowTitle}">					${fileShowTitle}				</c:when>				<c:otherwise>					<spring:message code="fileManager.btn.newFile" />				</c:otherwise>			</c:choose>		</c:when>	</c:choose></title><%@ include file="/pt/common/meta.jsp"%><style type="text/css">.view_process_table {	border: 1px solid #000;	border-collapse: collapse;}.view_process_table th {	border: 1px solid #000;	font-weight: normal;	font-size: 14px;	height: 24px;	background: none repeat scroll 0 0 #F7F7F7;}.view_process_table td {	border: 1px solid #000;	font-size: 12px;	height: 24px;}</style><%@ include file="/pt/dyform/dyform_css.jsp"%></head><body>	<div class="div_body">		<div class="form_header">			<!--标题-->			<div class="form_title">						<c:if test="${ operate ne 'add'}">				<h2>${file.title}</h2>			</c:if>			<c:choose>				<c:when test="${ operate eq 'add'}">					<c:choose>						<c:when test="${not empty fileShowTitle}">							<h2>${fileShowTitle}</h2>						</c:when>						<c:otherwise>							<h2><spring:message code="fileManager.btn.newFile" /></h2>						</c:otherwise>					</c:choose>				</c:when>			</c:choose>								<!--  <h1>当前登录用户：<security:authentication property="principal.username" /></h1>-->			</div>			<div id="toolbar" class="form_toolbar">				<div class="form_operate">					<c:if test="${ operate ne 'add' && versionManager eq '1' &&  '1' ne file.isLock}">					 						<c:if							test="${( FOLDER_ADMIN eq '1' || LIB_ADMIN eq '1') && (file.status eq '2' || file.status eq '1')}">							<button id="deleteButton" type="button" ><spring:message code="fileManager.btn.del" /></button>						</c:if>						<c:if test="${ FILE_OUT  eq '1' && file.status eq '2'}">							<button type="button" id="FILE_OUT"><spring:message code="fileManager.btn.fileOut" /></button>						</c:if>						<c:if test="${ FILE_SAVE  eq '1' && file.status eq '1'}">							<button id="save" type="button"><spring:message code="fileManager.btn.fileSaveDraft" /></button>						</c:if>						<c:if test="${file.status eq '3'}"><%-- 							<button type="button" id="FILE_CANCEL"><spring:message code="fileManager.btn.fileCancel" /></button> --%>						</c:if>						<c:choose>							<c:when								test="${ FILE_IN  eq '1' && ( file.status eq '1' || file.status eq '4')}">								<c:if test="${file.status eq '1'}">								<button type="button" id="FILE_IN"><spring:message code="fileManager.btn.fileIn" /></button>								</c:if>								<c:if test="${file.status eq '4'}">								<button id="versionDiscard" type="button"><spring:message code="fileManager.btn.fileCancelCheckIn" /></button>								<button type="button" id="FILE_IN"><spring:message code="fileManager.btn.fileIn" /></button>								</c:if>							</c:when>														<c:otherwise>								<c:if test="${ FILE_SEND_FOLW  eq '1' && file.status eq '1'}">								<button type="button" id="FILE_SEND_FOLW"									><spring:message code="fileManager.btn.fileSendFlow" /></button>								</c:if>								<c:if									test="${ FILE_SEND_CHECK_IN  eq '1' && file.status eq '1'}">									<button type="button" id="FILE_SEND_CHECK_IN"										><spring:message code="fileManager.btn.fileSendCheckIn" /></button>								</c:if>							</c:otherwise>						</c:choose>					</c:if>					<c:if	test="${ operate ne 'add' && (versionManager eq '0' || empty versionManager )}">						<!-- 不启用版本管理  -->						<c:if test="${ FILE_SAVE  eq '1' && editStatus eq '1' }">						<c:if test="${ file.status ne '2' }">							<button id="save" type="button"><spring:message code="fileManager.btn.save" /></button>						</c:if>						<button id="saveNormal" type="button"><spring:message code="fileManager.btn.fileSaveNormal" /></button>						</c:if>						<!-- 不启用版本管理  -->						<c:if test="${ FILE_SAVE  eq '1' && editStatus eq '0' }">							<c:if test="${ file.status ne '2' }">								<button id="save" type="button"><spring:message code="fileManager.btn.save" /></button>								<button id="saveNormal" type="button"><spring:message code="fileManager.btn.fileSaveNormal" /></button>							</c:if>							<c:if test="${ file.status eq '2' }">								<button id="btn_file_edit" type="button"><spring:message code="fileManager.btn.edit" /></button>							</c:if>						</c:if>						<c:if							test="${( FOLDER_ADMIN eq '1' || LIB_ADMIN eq '1')}">							<button id="deleteButton" type="button" ><spring:message code="fileManager.btn.del" /></button>						</c:if>					</c:if>					<c:if test="${ operate ne 'add'}">						<c:if test="${ FILE_VERSION  eq '1' && versionManager eq '1' }">							<button type="button" id="FILE_VERSION" ><spring:message code="fileManager.btn.viewHisVersion" /></button>						</c:if>						<c:if test="${ canPrint eq '1' &&  FILE_PRINT  eq '1'}">							<button type="button" id="FILE_PRINT"><spring:message code="fileManager.btn.print" /></button>						</c:if>					</c:if>					<c:if test="${ operate eq 'add' }">						<button id="save" type="button" ><spring:message code="fileManager.btn.fileSaveDraft" /></button>						<!-- 各个按钮增加对uuid为空情况的状态，作相应的状态处理，且operate置为add!!!! -->						<c:if test="${ versionManager eq '1'}">						<c:choose>							<c:when test="${ FILE_IN  eq '1' }">								<button type="button" id="FILE_IN"><spring:message code="fileManager.btn.fileIn" /></button>							</c:when>							<c:otherwise>							<c:if test="${ FILE_SEND_FOLW  eq '1' }">								<button type="button" id="FILE_SEND_FOLW"><spring:message code="fileManager.btn.fileSendFlow" /></button>								</c:if>								<c:if									test="${ FILE_SEND_CHECK_IN  eq '1'}">									<button type="button" id="FILE_SEND_CHECK_IN"><spring:message code="fileManager.btn.fileSendCheckIn" /></button>								</c:if>							</c:otherwise>													</c:choose>						</c:if>						<c:if test="${ versionManager eq '0' || empty versionManager}">							<!-- 不启用版本管理  -->							<button id="saveNormal" type="button"><spring:message code="fileManager.btn.fileSaveNormal" /></button>						</c:if>					</c:if><!-- 					<button type="button" class="btn" onclick="window.close();">关闭</button> -->				</div>			</div>		</div>		<div class="form_content">			<!-- 2正式，1草稿 -->			<%-- 			<label class="control-label">文件当前状态: ${fileStatus}</label> --%>		</div>		<input  id="data" type="hidden" value="${libId}" />		<form id="fileDynamicForm"></form>		<form class="form-horizontal" id="fileForm" name="fileForm"			action="${ctx}/fileManager/file/${method}" method="post">			<input id="folderId" name="folderId" type="hidden" value="${folderId}" />			<input id="dynamicFormId" name="dynamicFormId" type="hidden" value="${dynamicFormId}" />			<input id="dynamicDataId" name="dynamicDataId" type="hidden" value="${dynamicDataId}" />			<input id="operate" name="operate" type="hidden" value="${operate}" />			<input id="versionManager" name="versionManager" type="hidden" value="${versionManager}" />			<input id="uploadFileNames" name="uploadFileNames" type="hidden" />			<input id="uploadFileIds" name="uploadFileIds" type="hidden" />						<input id="uuid" name="uuid" type="hidden" value="${file.uuid}" />			<input id="title" type="hidden" name="title" value="${file.title}" size="16" />			<input id="author" name="author" type="hidden" value="${file.author}" />			<input id="fileType" name="fileType" type="hidden" value="${file.fileType}" />			<input id="showTitles" name="showTitles" type="hidden" value="${file.showTitles}">			<input id="status" name="status" type="hidden" value="${file.status}">			<input id="initId" name="initId" type="hidden" value="${file.initId}" /> 			<input id="flowInstUuid" name="flowInstUuid" type="hidden" value="${file.flowInstUuid}">			<input id="isLock" name="isLock" type="hidden" value="${file.isLock}">			<input id="currentVersion" name="currentVersion" type="hidden" value="${file.currentVersion}">			<input id="parentFolderIds" name="parentFolderIds" type="hidden" value="${file.parentFolderIds}">			<input id="sourceFileId" name="sourceFileId" type="hidden" value="${file.sourceFileId}">			<input id="reservedText1" name="reservedText1" type="hidden" value="${file.reservedText1}" />			<input id="reservedText2" name="reservedText2" type="hidden" value="${file.reservedText2}" />			<input id="reservedText3" name="reservedText3" type="hidden" value="${file.reservedText3}" />			<input id="reservedText4" name="reservedText4" type="hidden" value="${file.reservedText4}" />			<input id="reservedText5" name="reservedText5" type="hidden" value="${file.reservedText5}" />			<input id="reservedText6" name="reservedText6" type="hidden" value="${file.reservedText6}" />			<input id="reservedText7" name="reservedText7" type="hidden" value="${file.reservedText7}" />			<input id="reservedText8" name="reservedText8" type="hidden" value="${file.reservedText8}" />			<input id="reservedNumber1" name="reservedNumber1" type="hidden" value="${file.reservedNumber1}" />			<input id="reservedNumber2" name="reservedNumber2" type="hidden" value="${file.reservedNumber2}" />			<input id="reservedNumber3" name="reservedNumber3" type="hidden" value="${file.reservedNumber3}" />			<input id="reservedDate1" name="reservedDate1" type="hidden" value="${file.reservedDate1}" />			<input id="reservedDate2" name="reservedDate2" type="hidden" value="${file.reservedDate2}" />			<input id="creator" name="creator" type="hidden" value="${file.creator}" />			<input id="createTime" name="createTime" type="hidden" value="${file.createTime}" />						<input id="editStatus" name="editStatus" type="hidden" value="${editStatus}" />			<input id="canDownload" name="canDownload" type="hidden" value="${canDownload}" />						<!-- 编辑文档人员是否发生变更 -->			<input id="editFile" name="editFile" type="hidden" value="${editFile[0]}" />			<div id="sourceEditFileValue" style="display: none;">${editFile[0]}</div>			<input id="editFileChange" name="editFileChange" type="hidden" value="0" />			<!-- 阅读文档人员是否发生变更 -->			<input id="readFile" name="readFile" type="hidden" value="${readFile[0]}" />			<div id="sourceReadFileValue" style="display: none;">${readFile[0]}</div>			<input type="hidden" id="readFileChange" name="readFileChange" value="0">						<input id="methodName" name="methodName" type="hidden" value="${methodName}" />			<input id="scriptUrl" name="scriptUrl" type="hidden" value="${scriptUrl}" />			<!-- 打印模板form提交的url,默认为文件管理自身的打印url -->			<input id="print_form_url" name="print_form_url" type="hidden" value="${ctx}/fileManager/file/print" />			<!--是否需要二次打印 -->			<input id="is_print_second" name="is_print_second" type="hidden" value="" />			<!--二次打印原因弹出框html -->			<input id="second_print_reason_dialog_html" name="second_print_reason_dialog_html" type="hidden" value="" />						<c:forEach var="extraParam" items="${extraParamsMap}">					<input id="${extraParam.key}" name="${extraParam.key}" type="hidden" value='${extraParam.value}' />				</c:forEach>		</form>	 	<div id="historyVersionDialog" style="display: none">		<table id="historyFiles" class="view_process_table">			<thead>			<tr>				<th><spring:message code="fileManager.label.version" /></th>				<th><spring:message code="fileManager.label.createTime" /></th>				<th><spring:message code="fileManager.label.remark" /></th>				<th><spring:message code="fileManager.label.opreate" /></th>			</tr>			</thead>			<tbody></tbody>		</table>	</div>		<div id="showDifDialog" style="display: none">		<table class="table table-bordered table-striped">			<tr>				<td>				<spring:message code="fileManager.label.checkInType" />：				</td>				<td>				<input type="radio" name="operateInType" id="operateInType" value="versionSave" checked/><spring:message code="fileManager.label.newVersion" />				<c:if test="${file.currentVersion > '0.9'}">					<input type="radio" name="operateInType" id="operateInType" value="versionCover"/> <spring:message code="fileManager.label.replaceVersion" />				</c:if>				</td>			</tr>			<tr>				<td>				<spring:message code="fileManager.label.versionNumber" />：				</td>				<td>				<input id="currentSetVersion" name="currentSetVersion" style="width:98%;"					value="${file.currentVersion}" />				</td>			</tr>			<tr>				<td><spring:message code="fileManager.label.remark" />：				</td>				<td><textarea style="width:95%;" id="versionRemark" name="versionRemark" ></textarea>				</td>			</tr>		</table>	</div>		<div style="display: none">				<iframe id="print_form_iframe" name="print_form_iframe"					style="width: 1px; height: 0px;"></iframe>				<form id="print_form" name="print_form" action="" method="post"					target="print_form_iframe">					<input type="hidden" name="uuid" value="${file.uuid}" />					<input type="hidden" name="secondPrintReason" id="secondPrintReason" value="" />				</form>							</div>		</div>	<!-- /container -->	<div class="body_foot"></div>	<!-- Project -->	<script type="text/javascript">		var download = "2";		var needSelect = "0";		var canEdit = "${canEdit}";		var readOnly = true;		if(canEdit == "1"){			readOnly = false;		}	</script>	<c:if test="${canEdit == '1'}">		<script type="text/javascript">			download = "1";		</script>	</c:if>	<c:if test="${ needSelect eq '1'}">		<script type="text/javascript">			needSelect = "1";//需要进行模板选择		</script>	</c:if>	<script type="text/javascript">		// 不启用版本且为只读状态		if("${versionManager}" == "0" && "${editStatus}" == "0" && "${file.status}" == "2"){			readOnly = true;		}else if("${versionManager}" == "0" && "${editStatus}" == "1"){			readOnly = false;			// 可编辑权限可下载			download = 1;		}	</script>	<!-- Project -->	<%@ include file="/pt/dyform/dyform_js.jsp"%> 	<script type="text/javascript"		src="${ctx}/resources/pt/js/common/jquery.cmsWindown.js"></script>	<script type="text/javascript"		src='${ctx}/resources/pt/js/file/file.js'></script></body></html>