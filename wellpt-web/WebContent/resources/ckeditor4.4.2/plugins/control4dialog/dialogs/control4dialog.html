<div id="dialogAttrCfgDiv" title='属性设置'  style="width: auto; height:600px;overflow: scroll";>
	<div> 
		<div class="dyform">
			<div class="post-sign">
				<div class="post-detail">
		<table>
			<tr class="odd">
				<td class="Label">字段编码</td>
				<td class="value"><input type="text"
					name="name" id="name" value="" class="w100"/>  
			</tr>
			<!--3 -->
			<tr class="odd">
				<td class="Label">显示名称</td>
				<td class="value"><input type="text" class="w100" name="displayName"
					id="displayName" value="" /></td>
			</tr>
		
			<!--1 -->
			<tr class="odd">
				<td class="Label">应用于</td>
				<td class="value"><input type="text" class="w100" name="applyTo"
					id="applyTo" value="" /> </td>
			</tr>
			
		
			<tr class="odd">
				<td class="Label">字段长度</td>
				<td class="value">
					 <input type="text" value="" name="length"  id="length"  /> 
				</td>
			</tr>
			
			<tr>
				<td class="Label">视图设置</td>
				<td class="value"><input type="text" id="relationDataTextTwo" name="relationDataTextTwo" /></td>
				<input id="relationDataValueTwo" type="hidden" name="relationDataValueTwo" >
			</tr> 
			
			<tr>
				<td class="Label">约束条件</td>
				<td class="value"><input type="text" id="relationDataTwoSql" name="relationDataTwoSql" /></td>
			</tr> 
			
				<tr>
				<td class="Label">关联数据选择</td>
				<td class="value"><input id="relationDataDefiantion" type="text" style="display: none;" name="relationDataDefiantion">
					<table  >
					   <tr>
					     <td rowspan=2 style="width: 35%;text-align:left">添加映射关系：<select id="sqlField" name="sqlField" style="width: 90%;"></select></td>
					     <td>(数据库字段)-- <select id="formField" name="formField" style="width: 30%;"></select>(字段名称) <input id="searchCheck" type="checkbox" value="yes">查 
				<button class="addRelationField">添加</td>
					   </tr>
					   <tr><td>(用户自定义)--<input type="text" id="userDefinedField" name="userDefinedField" style="width: 35%;">(字段名称)&nbsp;&nbsp;&nbsp;<button class="addRelationUserField">添加</td>
							</select>		</td></tr>
					 </table>
				</td>
			</tr> 
			
			<tr>
			<td class="Label">映射关系</td>
			<td class="value">
			<div class="definitionDiv" style="margin-bottom: 5px;"  >
					<table class="definitiontrtable">
					<tbody>
					<tr class="definitiontitle" style="background-color:#DBDBDB;">
					<td>字段标题</td>
					<td>字段名</td>
					<td>表单字段</td>
					<td style="display: none;">字段名</td>
					<td>是否作为查询字段</td>
					<td>操作</td>
					</tr>
					<tr class="definitioncontentiteam" style="background-color:#ffffff;">
					</tr>
					</tbody>
					</table>
			</div>
			</td>
			</tr>
			
			<tr>
				<td class="Label">字体样式</td>
				<td class="value">
				
				<div class="tr_td_div_left">
					<span id="fontcolorElement" class="fontColorCss" ></span>
					<input type="hidden" value="" id="fontColor">
					<div class="subcolorCss" id="subcolor" >
					<div style="display: none;" class="colors">
						<span onclick="selColor('black');" style="background-color:black;" class="selectcolor"></span>
						<span onclick="selColor('red');" style="background-color:red " class="selectcolor"></span>
						<span onclick="selColor('blue');" style="background-color:blue " class="selectcolor"></span>
						<span onclick="selColor('orange');" style="background-color:orange " class="selectcolor"></span>
						<span onclick="selColor('green');" style="background-color:green " class="selectcolor"></span>
						<span onclick="selColor('yellow');" style="background-color:yellow " class="selectcolor"></span>
						<span onclick="selColor('purple');" style="background-color:purple " class="selectcolor"></span>
						<span onclick="selColor('silver');" style="background-color:silver " class="selectcolor"></span>
						<span onclick="selColor('tan');" style="background-color:tan " class="selectcolor"></span>
						<span onclick="selColor('maroon');" style="background-color:maroon;" class="selectcolor"></span>
						<span onclick="selColor('olive');" style="background-color:olive;" class="selectcolor"></span>
						<span onclick="selColor('gray');" style="background-color:gray;" class="selectcolor"></span>
						<span onclick="selColor('lime');" style="background-color:lime;" class="selectcolor"></span>
					</div>
					</div>
				</div>
			 <div class="tr_td_div_left">
					<select name="fontSize" id="fontSize" style="display: block;float: left;width: 112px;">
						
						<option value="8" style="font-size:8px;">8</option>
						<option value="9" style="font-size:9px;">9</option>
						<option value="10" style="font-size:10px;">10</option>
						<option value="11" style="font-size:11px;">11</option>
						<option value="12" style="font-size:12px;" selected="selected">12</option>
						<option value="14" style="font-size:14px;">14</option>
						<option value="16" style="font-size:16px;">16</option>
						<option value="18" style="font-size:18px;">18</option>
						<option value="20" style="font-size:20px;">20</option>
						<option value="22" style="font-size:22px;">22</option>
						<option value="24" style="font-size:24px;">24</option>
						<option value="26" style="font-size:26px;">26</option>
						<option value="28" style="font-size:28px;">28</option>
						<option value="36" style="font-size:36px;">36</option>
						<option value="48" style="font-size:48px;">48</option>
						<option value="72" style="font-size:72px;">72</option>
					</select>
				</div>
				</td>
			</tr>
			
			
			<tr  class="odd">
				<td class="Label">控件样式</td>
				<td class="value">
				 
				<div class="tr_td_div_left">
					<span style="float: left;padding-top: 9px;margin-right: 3px;">宽度:</span><input type="text" name="ctlWidth" id="ctlWidth" style="width: 25px;float: left;"/>
				</div>
				<div class="tr_td_div_left">
					<span style="float: left;padding-top: 9px;margin-right: 3px;">高度:</span><input type="text" name="ctlHight" id="ctlHight" style="width: 25px;float: left;"/>
				</div>
				<div class="tr_td_div_left">
					<select name="textAlign" id="textAlign"  style="width: 100px;">
						<option value="">--对齐方式--</option>
						<option value="center">居中</option>
						<option value="left">靠左</option>
						<option value="right">靠右</option>
					</select>
				</div>
				</td>
			</tr>
 			<tr>
				<td class="Label">编辑模式</td>
				<td class="value"> 
					<div class="tr_td_div_left" style="padding-top: 9px;"> 
				<input type="radio" name="showType" value="1" checked="checked">可编辑
						<input type="radio" name="showType" value="3"> 只读
						<input type="radio" name="showType" value="2">显示文本
						<input type="radio" name="showType" value="4"> 禁用
						<input type="radio" name="showType" value="5"> 隐藏
					</div>
				</td>
			</tr>
			 
			 
			<tr class="odd" >
				<td class="Label">校验规则</td>
				<td class="value">
					<input type="checkbox" name="fieldCheckRules" id="checkRule_1" value="1"  onclick="checkMust(this)"/><label for="checkRule_1">非空</label>  
					<input type="checkbox" name="fieldCheckRules" id="checkRule_5" value="5" onclick="checkUnique(this)"/><label for="checkRule_5">唯一</label></td>
			</tr> 
			
				 
			<tr id="tr_onlyreadUrl" >
				<td class="Label">标识地址</td>
				<td class="value"><input type="text" id="onlyreadUrl" name="onlyreadUrl" /></td>
			</tr> 
			
		
			
		</table>
		
	</div>
	</div>
		</div>
		</div>
</div>
<script type="text/javascript">


var dialogctl = {};

 
dialogctl.$ =  function(selector){ 
	return $(selector, $("#dialogAttrCfgDiv"));
} 

$.extend(dialogctl, $.ControlConfigUtil);
/**
 * 初始化属性窗口
 */
 dialogctl.initPropertyDialog = function (editor){
	 $(".cke_reset_all").removeClass("cke_reset_all");//删除ckeditor内部的局css
	this.editor = editor;
	//loadCommonJsFile();//加载自定义的ckeditor公共js 
	var focusedDom = editor.focusedDom;//当前editor被双击的对象(CKEDITOR.dom.node类) 
	var field = null;
	if(focusedDom != null && (typeof focusedDom) != "undefined"){
		var fieldName = $(focusedDom).attr("name");
		field = formDefinition.fields[fieldName];//表单中从表的信息 
	}
	this.initProperty(field);
};

dialogctl.initProperty = function(field){
	if(field == null ||  (typeof field) == "undefined"){
		field = new WDialogClass();
		field.dbDataType = dyFormInputType.dialog;
		field.valueCreateMethod = "1";
	}else{
	}
	//公共属性
	this.ctlPropertyComInitSet(field);

	var relationSettingTwo = {
			async : {
				otherParam : {
					"serviceName" : "viewDefinitionService",
					"methodName" : "getViewAsTreeAsync",
				}
			},
			check : {
				enable : false,
			},
			callback : {
				onClick: treeNodeOnClick2,
			}
	};
	$("#relationDataTextTwo").comboTree({
		labelField: "relationDataTextTwo",
		valueField: "relationDataValueTwo",
		treeSetting : relationSettingTwo,
		width: 220,
		height: 220
	});
	$("#relationDataTextTwo").val(field.relationDataTextTwo);
	$("#relationDataValueTwo").val(field.relationDataValueTwo);
	$("#relationDataTwoSql").val(field.relationDataTwoSql);
	$("#relationDataTextTwo").addClass("input-tier");
	//绑定初始的数据列
	if(field.relationDataTextTwo!="" && field.relationDataTextTwo!=undefined){
		sqlOption2(field.relationDataValueTwo);
	}
	
	$(".definitioncontentiteam").remove();
	$("#relationDataDefiantion").val(field.relationDataDefiantion);
	if(field.relationDataDefiantion!=""){
		var str = field.relationDataDefiantion;
		var tempArray = str.split("|");
		for(var j=0;j<tempArray.length;j++){
			var tempObj = JSON.parse(tempArray[j]);
			var relationDataDefiantion = '<tr class="definitioncontentiteam">';
			relationDataDefiantion += '<td>'+tempObj.sqlTitle+'</td>';
			relationDataDefiantion += '<td>'+tempObj.sqlField+'</td>';
			relationDataDefiantion += '<td>'+tempObj.formTitle+'</td>';
			relationDataDefiantion += '<td  style="display: none;">'+tempObj.formField+'</td>';
			relationDataDefiantion += '<td>'+tempObj.search+'</td>';
			relationDataDefiantion += '<td><button class="delField">删除</button></td>';
			relationDataDefiantion += '</tr>';
			$(".definitiontrtable").append(relationDataDefiantion);
		}
	}
	
	
	$(".addRelationField").click(function(){
		var sqlFieldText = $("#sqlField option:selected").text();
		var sqlFieldValue = $("#sqlField option:selected").val();
		var formFieldText = $("#formField option:selected").text();
		var formFieldValue = $("#formField option:selected").val();
		var searchCheck = $("#searchCheck ").val();
		if($("#searchCheck:checked").val()=='yes'){
			searchCheck = "yes";
		}else{
			searchCheck = "no";
		}
		var relationDataDefiantion = '<tr class="definitioncontentiteam">';
		relationDataDefiantion += '<td>'+sqlFieldText+'</td>';
		relationDataDefiantion += '<td>'+sqlFieldValue+'</td>';
		relationDataDefiantion += '<td>'+formFieldText+'</td>';
		relationDataDefiantion += '<td  style="display: none;">'+formFieldValue+'</td>';
		relationDataDefiantion += '<td>'+searchCheck+'</td>';
		relationDataDefiantion += '<td><button class="delField">删除</button></td>';
		relationDataDefiantion += '</tr>';
		$(".definitiontrtable").append(relationDataDefiantion);
	});
	
	$(".addRelationUserField").click(function(){
		var sqlFieldText = $("#sqlField option:selected").text();
		var sqlFieldValue = $("#sqlField option:selected").val();
		var formFieldText = $("#userDefinedField").val();
		var formFieldValue = $("#userDefinedField").val();
		var relationDataDefiantion = '<tr class="definitioncontentiteam">';
		relationDataDefiantion += '<td>'+sqlFieldText+'</td>';
		relationDataDefiantion += '<td>'+sqlFieldValue+'</td>';
		relationDataDefiantion += '<td>'+formFieldText+'</td>';
		relationDataDefiantion += '<td  style="display: none;">'+formFieldValue+'</td>';
		relationDataDefiantion += '<td>'+"no"+'</td>';
		relationDataDefiantion += '<td><button class="delField">删除</button></td>';
		relationDataDefiantion += '</tr>';
		$(".definitiontrtable").append(relationDataDefiantion);
	});
	
	
	$(".subDelField").live("click",function(){
		$(this).parent().parent().remove();
	});
	
	$(".delField").live("click",function(){
		$(this).parent().parent().remove();
	});

	
	//初始化字段下拉
	var optionStr="";
	var data=formDefinition.fields;
  	for(var key in data){ 
	    optionStr += "<option value="+data[key].name+">"+data[key].displayName+"</option>";
	} 
	$("#formField").html(optionStr);
}


dialogctl.exitDialog = function(){
	this.editor.focusedDom = null;
}

dialogctl.collectFormAndFillCkeditor = function(){ 
	var field = new WDialogClass();

	//控件公共属性收集
	var checkpass=this.collectFormCtlComProperty(field);
	if(!checkpass){
		return false;
	}
	field.inputMode =  dyFormInputMode.dialog;
	
	field.relationDataTextTwo =$("#relationDataTextTwo").val();
	field.relationDataValueTwo =$("#relationDataValueTwo").val();
	field.relationDataTwoSql =$("#relationDataTwoSql").val();
	
	var definitioncontentContent = new Array();
	$(".definitioncontentiteam").each(function(){
		var objTemp = new Object();
		objTemp.sqlTitle = $(this).find("td").eq(0).html();
		objTemp.sqlField = $(this).find("td").eq(1).html();
		objTemp.formTitle = $(this).find("td").eq(2).html();
		objTemp.formField = $(this).find("td").eq(3).html();
		objTemp.search = $(this).find("td").eq(4).html(); 
		definitioncontentContent.push(JSON.stringify(objTemp));
	});
	field.relationDataDefiantion = definitioncontentContent.join("|");
	
	//创建控件占位符
	this.createControlPlaceHolder(this,this.editor.imageOfDialogctl,field);
	
	formDefinition.fields[field.name] = field; 
	
	return true;
}

function treeNodeOnClick2(event, treeId, treeNode) {
	if(!treeNode.isParent){
		if(treeNode.name!=$("#relationDataTextTwo").val()){
			$(".definitioncontentiteam").remove();
		}
		$("#relationDataTextTwo").val(treeNode.name);
		$("#relationDataValueTwo").val(treeNode.id);
		JDS.call({
			service:"viewDefinitionService.getColumnDefinitions",
			data:[treeNode.id],
			async : false,
			success:function(result) { 
				data = result.data;
				var optionStr = "";
				for(var i=0;i<data.length;i++) {
					var titleName = data[i].otherName;
					if(titleName==""){
						titleName = data[i].titleName;
					}
					if(data[i].columnAliase == "" || data[i].columnAliase == null || data[i].columnAliase == undefined) {
						optionStr += "<option value='"+data[i].fieldName+"'>"+titleName+"</option>";
					}else {
						optionStr += "<option value='"+data[i].columnAliase+"'>"+titleName+"</option>";
					}
				}
				$("#sqlField").html(optionStr);
			}
		});
	}
}

function sqlOption2(relationDataValueTwo){
	if(relationDataValueTwo!="" && relationDataValueTwo!= undefined){
		JDS.call({
			service:"viewDefinitionService.getColumnDefinitions",
			data:[relationDataValueTwo],
			success:function(result) { 
				data = result.data;
				var optionStr = "";
				for(var i=0;i<data.length;i++) {
					var titleName = data[i].otherName;
					if(titleName==""){
						titleName = data[i].titleName;
					}
					if(data[i].columnAliase == "" && data[i].columnAliase == null) {
						optionStr += "<option value='"+data[i].fieldName+"'>"+titleName+"</option>";
					}else {
						optionStr += "<option value='"+data[i].columnAliase+"'>"+titleName+"</option>";
					}
				}
				$("#sqlField").html(optionStr);
			}
		});
	}
}


</script>