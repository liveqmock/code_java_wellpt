 
<div id="checkboxAttrCfgDiv" title='属性设置'  style=" height: 400px; overflow: auto;">
	<div> 
		<div class="dyform">
			<div class="post-sign">
				<div class="post-detail">
		<table>
			<tr class="odd">
				<td class="Label">字段编码</td>
				<td class="value"><input type="text"
					name="name" id="name" value="" class="w100"/>  
			</tr>
			<!--3 -->
			<tr >
				<td class="Label">显示名称</td>
				<td class="value"><input type="text" class="w100" name="displayName"
					id="displayName" value="" /></td>
			</tr>
		
			<!--1 -->
			<tr class="odd">
				<td class="Label">应用于</td>
				<td class="value"><input type="text" class="w100" name="applyTo"
					id="applyTo" value="" /> </td>
			</tr>
			
			<tr >
				<td class="Label">默认值</td>
				<td class="value">
					 <input type="text" value="" name="defaultValue"  id="defaultValue" /> 
				</td>
			</tr>
			
				<tr class="odd">
				<td class="Label">字段长度</td>
				<td class="value">
					 <input type="text" value="" name="length"  id="length"  /> 
				</td>
			</tr>
			
					<tr >
				<td class="Label">显示值字段<br/></td>
				<td class="value">
					 <select name="realDisplay_display" id="realDisplay_display">
					 	<option value="">--请选择--</option>
					 	
					 </select>
				</td>
			</tr>
			
			<tr >
				<td class="Label">真实值字段<br/></td>
				<td class="value">
					 <select name="realDisplay_real" id="realDisplay_real">
					 	<option value="">--请选择--</option>
					 	
					 </select>
				</td>
			</tr>
			
				<tr>
				<td class="Label">选择模式</td>
				<td class="value">
				<input id="selectMode_1" type="radio" value="1" name="selectMode">
				<label for="selectMode_1">单选</label>
				<input id="selectMode_2" type="radio" value="2" name="selectMode" checked="checked">
				<label for="selectMode_2">多选</label>
				</td>
			</tr>
			
			<tr id='tr_singleChecksrc' hide="true">
				<td  class="Label">单选设置</td>
				<td class="value">&nbsp选中&nbsp<input type="text" id="singleCheck" name="singleCheck" value="" style="width:36%"/>&nbsp&nbsp&nbsp取消&nbsp<input type="text" id="singleUnCheck" name="singleUnCheck" value="" style="width:36%"/></td>
			</tr> 	
			
			<tr id='tr_optionDataSource' >
				<td class="Label">备选项来源</td>
				<td class="value">
				<input id="optionDataSource_1" type="radio" value="1" name="optionDataSource">
				<label for="optionDataSource_1">常量</label>
				<input id="optionDataSource_2" type="radio" value="2" name="optionDataSource" checked="checked">
				<label for="optionDataSource_2">取字典</label>
				</td>
			</tr>
				
			<tr id='tr_data' hide="true">
				<td  class="Label">备选项设置</td>
				<td class="value"><input type="text" id="optdata" name="optdata" value=""/></td>
			</tr> 	
				
			<tr id='tr_dicCode'>
				<td  class="Label">字典编码</td>
				<td class="value">
				<input id="dictName" class="w100" type="text" value="--请选择--" name="dictName">
				<input id="dictCode" type="hidden" class="w100" type="text"  name="dictCode">
				
				<ul id="datadict_tree" class="ztree"></ul>
				</td>
			</tr>
				
			<tr id='tr_ctrField'>
				<td class="Label">控制显示\隐藏字段</td>
				<td class="value">
				<input id="checkboxAttrCfgDiv_ctrlFieldName" type="text" name="ctrlFieldName" value="">
				<input id="checkboxAttrCfgDiv_ctrlField" type="hidden"  class="w100" name="ctrlField" value="">
				</td>
			</tr>
			
			
			<tr>
				<td class="Label">字体样式</td>
				<td class="value">
				
				<div class="tr_td_div_left">
					<span id="fontcolorElement" class="fontColorCss" ></span>
					<input type="hidden" value="" id="fontColor">
					<div class="subcolorCss" id="subcolor" >
					<div style="display: none;" class="colors">
						<span onclick="selColor('black');" style="background-color:black;" class="selectcolor"></span>
						<span onclick="selColor('red');" style="background-color:red " class="selectcolor"></span>
						<span onclick="selColor('blue');" style="background-color:blue " class="selectcolor"></span>
						<span onclick="selColor('orange');" style="background-color:orange " class="selectcolor"></span>
						<span onclick="selColor('green');" style="background-color:green " class="selectcolor"></span>
						<span onclick="selColor('yellow');" style="background-color:yellow " class="selectcolor"></span>
						<span onclick="selColor('purple');" style="background-color:purple " class="selectcolor"></span>
						<span onclick="selColor('silver');" style="background-color:silver " class="selectcolor"></span>
						<span onclick="selColor('tan');" style="background-color:tan " class="selectcolor"></span>
						<span onclick="selColor('maroon');" style="background-color:maroon;" class="selectcolor"></span>
						<span onclick="selColor('olive');" style="background-color:olive;" class="selectcolor"></span>
						<span onclick="selColor('gray');" style="background-color:gray;" class="selectcolor"></span>
						<span onclick="selColor('lime');" style="background-color:lime;" class="selectcolor"></span>
					</div>
					</div>
				</div>
			 <div class="tr_td_div_left">
					<select name="fontSize" id="fontSize" style="display: block;float: left;width: 112px;">
						
						<option value="8" style="font-size:8px;">8</option>
						<option value="9" style="font-size:9px;">9</option>
						<option value="10" style="font-size:10px;">10</option>
						<option value="11" style="font-size:11px;">11</option>
						<option value="12" style="font-size:12px;" selected="selected">12</option>
						<option value="14" style="font-size:14px;">14</option>
						<option value="16" style="font-size:16px;">16</option>
						<option value="18" style="font-size:18px;">18</option>
						<option value="20" style="font-size:20px;">20</option>
						<option value="22" style="font-size:22px;">22</option>
						<option value="24" style="font-size:24px;">24</option>
						<option value="26" style="font-size:26px;">26</option>
						<option value="28" style="font-size:28px;">28</option>
						<option value="36" style="font-size:36px;">36</option>
						<option value="48" style="font-size:48px;">48</option>
						<option value="72" style="font-size:72px;">72</option>
					</select>
				</div>
				</td>
			</tr>
 			
				<td class="Label">编辑模式</td>
				<td class="value"> 
					<div class="tr_td_div_left" style="padding-top: 9px;"> 
						<input type="radio" name="showType" value="1" checked="checked">可编辑
						<input type="radio" name="showType" value="2">显示文本
						<input type="radio" name="showType" value="4"> 禁用
						<input type="radio" name="showType" value="5"> 隐藏
					</div>
				</td>
			</tr>
			 
			<tr class="odd" >
				<td class="Label">校验规则</td>
				<td class="value">
					<input type="checkbox" name="fieldCheckRules" id="checkRule_1" value="1"  onclick="checkMust(this)"/><label for="checkRule_1">非空</label>  
					<input type="checkbox" name="fieldCheckRules" id="checkRule_5" value="5" onclick="checkUnique(this)"/><label for="checkRule_5">唯一</label></td>
			</tr> 
			
				 
		<!-- 	<tr>
				<td class="Label">标识地址</td>
				<td class="value"><input type="text" id="onlyreadUrl" name="onlyreadUrl" /></td>
			</tr>  -->
			
		
			
		</table>
		
	</div>
	</div>
		</div>
		</div>
</div>
<script type="text/javascript">
var checkboxctl = {};
checkboxctl.$ =  function(selector){ 
	return $(selector, $("#checkboxAttrCfgDiv"));
} 

$.extend(checkboxctl, $.ControlConfigUtil);

/**
 * 初始化属性窗口
 */
 checkboxctl.initPropertyDialog = function (editor){
	 $(".cke_reset_all").removeClass("cke_reset_all");//删除ckeditor内部的局css
	this.editor = editor;
	//loadCommonJsFile();//加载自定义的ckeditor公共js 
	var focusedDom = editor.focusedDom;//当前editor被双击的对象(CKEDITOR.dom.node类) 
	//初始化ctrlfield.
	this.initCtrlField();
	var field = null;
	if(focusedDom != null && (typeof focusedDom) != "undefined"){
		var fieldName = $(focusedDom).attr("name");
		field = formDefinition.fields[fieldName];//表单中从表的信息 
	}
	
	this.initProperty(field);
	console.log(JSON.stringify(field));
};

checkboxctl.initProperty = function(field){
	
	//初始化数据字典树.
	this.initDictCode();
	
	 $("input[name='selectMode']").change(
			 function(){
				 
				 var checkvalue=$("input[name='optionDataSource']:checked").val();
				 if(checkvalue=='1'){
					 $('#tr_dicCode').hide();
					 $('#tr_data').show();
					 $("input[name='dictCode']").val();
					 $("input[name='dictName']").val();
				 }else{
					 $("#tr_dicCode").show();
					 $("#tr_data").hide();
					 $("#optdata").val();
				 }
				 
				 var selectmode=$("input[name='selectMode']:checked").val();
				 if(selectmode=='1'){
					 $('#tr_optionDataSource').hide();
					 $("#tr_singleChecksrc").show();
					 $("#tr_ctrField").show();
					 $("#tr_data").hide();
					 $("#tr_dicCode").hide();
				 }else{
					 $('#tr_optionDataSource').show();
					 $("#tr_singleChecksrc").hide();
					 $("#tr_ctrField").hide();
				 }
				 
				
			 }
		 );
	
	 $("input[name='optionDataSource']").change(
			 function(){
				 var checkvalue=$("input[name='optionDataSource']:checked").val();
				 if(checkvalue=='1'){
					 $('#tr_dicCode').hide();
					 $('#tr_data').show();
					 $("input[name='dictCode']").val();
					 $("input[name='dictName']").val();
				 }else{
					 $("#tr_dicCode").show();
					 $("#tr_data").hide();
					 $("#optdata").val();
				 }
			 }
		 );
	
	if(field == null ||  (typeof field) == undefined){
		field = new WCheckBoxClass();
		field.inputMode =  dyFormInputMode.checkbox;
		field.valueCreateMethod = "1";
		field.selectMode = "2";
	}
	//控件属性初始化公共设置.
	this.ctlPropertyComInitSet(field);
	
	//私有属性
	$("#singleCheck").val(field.singleCheckContent);
	$("#singleUnCheck").val(field.singleUnCheckContent);
	
	if(field.optionDataSource=='2'){
		$("input[name='optionDataSource'][value='"+2+"']").attr("checked",true);
		$('#tr_dicCode').show();
		 $('#tr_data').hide();
	}else if(field.optionDataSource=='1'){
		$("input[name='optionDataSource'][value='"+1+"']").attr("checked",true);
		$('#tr_dicCode').hide();
		$('#tr_data').show();
		
	}else{
		 $('#tr_data').hide();
	}
	
	if(field.selectMode=='2'){
		$("input[name='selectMode'][value='"+2+"']").attr("checked",true);
		$('#tr_optionDataSource').show();
		 $("#tr_singleChecksrc").hide();
		 $("#tr_ctrField").hide();
	
	}else{
		$("input[name='selectMode'][value='"+1+"']").attr("checked",true);
			$('#tr_optionDataSource').hide();
			 $("#tr_singleChecksrc").show();
			 $("#tr_ctrField").show();
			 $('#tr_dicCode').hide();
			 $('#tr_data').hide();
	}
	
	
	$("#checkboxAttrCfgDiv_ctrlField").val(field.ctrlField);
    $("#checkboxAttrCfgDiv_ctrlFieldName").val(field.ctrlField.split(",")[1])

	if(field.dictCode!=""&&field.dictCode!="undefined"){
		$("#dictCode").val(field.dictCode);
		var dictcodearray=field.dictCode.split(":");
		$("#dictName").val(dictcodearray[1]);
	}
	
	if(JSON.stringify(field.optionSet)!='[]'){
		$("#optdata").val(JSON.stringify(field.optionSet));
	}
}


checkboxctl.exitDialog = function(){
	this.editor.focusedDom = null;
}

checkboxctl.collectFormAndFillCkeditor = function(){ 
	var field = new WCheckBoxClass();
	field.ctrlField=$("#checkboxAttrCfgDiv_ctrlField").val();
	field.inputMode =  dyFormInputMode.checkbox;

	field.optionDataSource=$("input[name='optionDataSource']:checked").val();
	field.selectMode=$("input[name='selectMode']:checked").val();
	
	field.singleCheckContent=$("#singleCheck").val();
	field.singleUnCheckContent=$("#singleUnCheck").val();
	//控件公共属性收集
	var checkpass=this.collectFormCtlComProperty(field);
	if(!checkpass){
		return false;
	}
	if(field.selectMode=='2'){
		if(field.optionDataSource=='1'){
			if($("#optdata").val()==""||$("#optdata").val()==undefined){
				alert("备选项设置不能为空！");
				return false;
			}
			field.optionSet=eval("("+$("#optdata").val()+")");
		}else{
			 if($("#dictName").val()==""||$("#dictName").val()==undefined){
				alert("字典编码不能为空！");
				return false;
			} 
			 //编码跟name一样，收集时取name为了支持手录.
			field.dictCode= $("#dictCode").val();
		}
		//多选的清空单选内容
		field.singleCheckContent="";
		field.singleUnCheckContent="";
	}else{
		if($("#singleCheck").val()==""||$("#singleCheck").val()==undefined){
			alert("选中设置不能为空！");
			return false;
		}
		if($("#singleUnCheck").val()==""||$("#singleUnCheck").val()==undefined){
			alert("取消选中设置不能为空！");
			return false;
		}
		//单选的清空多选内容
		field.optionSet=[];
		field.dictCode="";
	}
	
	//创建控件占位符
	this.createControlPlaceHolder(this,this.editor.imageOfCheckboxctl,field);
	formDefinition.fields[field.name] = field; 
	return true;
	
}
	
	
checkboxctl.initCtrlField=function(){
	 var ctrlFieldSetting = {
			 async : {
			 otherParam : {
				 "serviceName" : "dyFormDefinitionService",
				 "methodName" : "getFieldByFormUuid",
				 "data":formDefinition.uuid
			 }
			 },
			 callback : {
				 onClick:treeNodeOnClickForctrlFieldSetting,
				 onCheck:treeNodeOnCheckForctrlFieldSetting
			 }
			 };
			 $("#checkboxAttrCfgDiv_ctrlFieldName").comboTree({
				 labelField : "checkboxAttrCfgDiv_ctrlFieldName",
				 valueField : "checkboxAttrCfgDiv_ctrlField",
				 treeSetting : ctrlFieldSetting,
				 width: 220,
				 height: 220
			 });
			 function treeNodeOnClickForctrlFieldSetting(event, treeId, treeNode) {
				 $("#checkboxAttrCfgDiv_ctrlFieldName").val(treeNode.name);
				 $("#checkboxAttrCfgDiv_ctrlField").val(treeNode.id + ","+ treeNode.name);
			 }
			 function treeNodeOnCheckForctrlFieldSetting(event, treeId, treeNode) {
				 // 设置值
				 var zTree = $.fn.zTree.getZTreeObj(treeId);
				 var checkNodes = zTree.getCheckedNodes(true);
				 var path = "";
				 var value = "";
				 for ( var index = 0; index < checkNodes.length; index++) {
				 var checkNode = checkNodes[index];
				
				 if (path == "") {
				 path = getAbsolutePath(checkNode);
				 } else {
				 path = path + ";" + getAbsolutePath(checkNode);
				 }
				 if (value == "") {
				 value = checkNode.id;
				 } else {
				 value = value + ";" + checkNode.id;
				 }
				 }
				 $("#checkboxAttrCfgDiv_ctrlFieldName").val(path);
				 $("#checkboxAttrCfgDiv_ctrlField").val(value + "," + path);
			 } 
}



</script>